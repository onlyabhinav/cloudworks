<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dev Bookmarks</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Fira+Code&family=JetBrains+Mono:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
    />

    <style>
      /* ... (Font imports and color variables remain the same) ... */
      :root {
        --font-family: "JetBrains Mono", "Fira Code", monospace;
        --bg-color: #1e1e1e;
        --card-bg-color: #252526;
        --border-color: #333;
        --text-color: #d4d4d4;
        --link-color: #9cdcfe;
        --link-hover-color: #4fc1ff;
        --header-color: #cccccc;
        --accent-color: #007acc;
        --subtle-text-color: #888;
      }

      body.light-theme {
        --bg-color: #f5f5f5;
        --card-bg-color: #ffffff;
        --border-color: #e0e0e0;
        --text-color: #212121;
        --link-color: #00558a;
        --link-hover-color: #007acc;
        --header-color: #333333;
        --accent-color: #007acc;
        --subtle-text-color: #666;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: var(--font-family);
        background-color: var(--bg-color);
        color: var(--text-color);
        font-size: 14px;
        padding: 20px;
        transition: background-color 0.3s, color 0.3s;
      }

      header {
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 1px solid var(--border-color);
      }
      .title-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }
      .title-container h1 {
        color: var(--header-color);
        font-weight: 500;
        flex-grow: 1;
      }
      .controls-container {
        display: flex;
        gap: 10px;
      }
      #theme-toggle,
      #layout-toggle {
        background: none;
        border: 1px solid var(--border-color);
        color: var(--text-color);
        width: 32px;
        height: 32px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background-color 0.2s, color 0.2s;
      }
      #theme-toggle:hover,
      #layout-toggle:hover {
        background-color: var(--card-bg-color);
        color: var(--link-hover-color);
      }

      #filter-container {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        gap: 15px;
      }
      #filter-container h3 {
        font-size: 1em;
        font-weight: 500;
        margin-right: 10px;
      }
      #filter-container label {
        display: inline-flex;
        align-items: center;
        cursor: pointer;
        background-color: var(--card-bg-color);
        padding: 5px 10px;
        border-radius: 4px;
        border: 1px solid var(--border-color);
        transition: background-color 0.2s;
      }

      /* --- LAYOUT STYLES --- */

      /* Default Layout: Rows */
      #bookmarks-container {
        display: flex;
        flex-direction: column;
        gap: 25px;
      }
      .bookmark-section {
        width: 100%;
        transition: opacity 0.3s ease, transform 0.3s ease;
      }
      .categories-wrapper {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
      }
      .category {
        background-color: var(--card-bg-color);
        border: 1px solid var(--border-color);
        border-radius: 6px;
        padding: 15px;
        flex: 1 1 300px;
      }
      .category h3 {
        font-size: 1em;
        color: var(--text-color);
        margin-bottom: 10px;
        font-weight: 600;
        border-bottom: 1px solid var(--border-color);
        padding-bottom: 5px;
      }

      /* Column Layout Overrides */
      #bookmarks-container.layout-columns {
        flex-direction: row;
        overflow-x: auto;
        padding-bottom: 10px;
      }
      #bookmarks-container.layout-columns .bookmark-section {
        width: auto; /* <<< THIS IS THE FIX <<< */
        min-width: 320px;
        flex-shrink: 0;
        background-color: var(--card-bg-color);
        border: 1px solid var(--border-color);
        border-radius: 6px;
        padding: 15px;
      }
      #bookmarks-container.layout-columns .categories-wrapper {
        display: block;
      }
      #bookmarks-container.layout-columns .category {
        flex-basis: auto;
        padding: 0;
        border: none;
        background-color: transparent;
        margin-bottom: 15px;
      }

      .bookmark-section.hidden {
        display: none;
      }
      .bookmark-section h2 {
        font-size: 1.2em;
        color: var(--header-color);
        border-bottom: 1px solid var(--border-color);
        padding-bottom: 8px;
        margin-bottom: 15px;
      }

      ul {
        list-style-type: none;
      }
      li {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 6px 0;
      }
      a {
        color: var(--link-color);
        text-decoration: none;
        transition: color 0.2s ease;
        display: flex;
        align-items: center;
      }
      a:hover {
        color: var(--link-hover-color);
        text-decoration: underline;
      }
      a i {
        margin-right: 10px;
        width: 16px;
        text-align: center;
        color: var(--subtle-text-color);
        transition: color 0.2s ease;
      }
      a:hover i {
        color: var(--link-hover-color);
      }
      .copy-btn {
        background: none;
        border: none;
        color: var(--subtle-text-color);
        cursor: pointer;
        font-size: 1em;
        padding: 5px;
        transition: color 0.2s ease;
      }
      #copy-feedback {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background-color: var(--accent-color);
        color: white;
        padding: 8px 16px;
        border-radius: 5px;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s, visibility 0.3s;
        z-index: 1000;
      }
      #copy-feedback.show {
        opacity: 1;
        visibility: visible;
      }
    </style>
  </head>
  <body>
    <header>
      <div class="title-container">
        <h1><i class="fa-solid fa-book-bookmark"></i> Dev Bookmarks</h1>
        <div class="controls-container">
          <button id="layout-toggle" title="Switch to Column Layout">
            <i class="fa-solid fa-table-columns"></i>
          </button>
          <button id="theme-toggle" title="Toggle theme">
            <i class="fa-solid fa-sun"></i>
          </button>
        </div>
      </div>
      <div id="filter-container">
        <h3>Filter Sections:</h3>
        {% for section_name in bookmarks.keys() %}
        <label>
          <input
            type="checkbox"
            class="section-toggle"
            value="{{ section_name }}"
            checked
          />
          {{ section_name }}
        </label>
        {% endfor %}
      </div>
    </header>

    <main id="bookmarks-container">
      {% for section_name, section_content in bookmarks.items() %}
      <section class="bookmark-section" data-section-name="{{ section_name }}">
        <h2>{{ section_name }}</h2>
        <div class="categories-wrapper">
          {% for category_name, links in section_content.items() %}
          <div class="category">
            <h3>{{ category_name }}</h3>
            <ul>
              {% for link_name, url in links.items() %}
              <li>
                <a href="{{ url }}" target="_blank" rel="noopener noreferrer">
                  <i class="{{ get_icon_for_url(url) }}"></i>
                  {{ link_name }}
                </a>
                <button class="copy-btn" data-url="{{ url }}" title="Copy link">
                  <i class="fa-regular fa-copy"></i>
                </button>
              </li>
              {% endfor %}
            </ul>
          </div>
          {% endfor %}
        </div>
      </section>
      {% endfor %}
    </main>

    <div id="copy-feedback">Copied!</div>

    <script>
      // --- The JavaScript section is unchanged and correct ---
      document.addEventListener("DOMContentLoaded", () => {
        const themeToggleBtn = document.getElementById("theme-toggle");
        const body = document.body;
        const applyTheme = (theme) => {
          if (theme === "light") {
            body.classList.add("light-theme");
            themeToggleBtn.innerHTML = '<i class="fa-solid fa-moon"></i>';
          } else {
            body.classList.remove("light-theme");
            themeToggleBtn.innerHTML = '<i class="fa-solid fa-sun"></i>';
          }
        };
        const savedTheme = localStorage.getItem("theme") || "dark";
        applyTheme(savedTheme);
        themeToggleBtn.addEventListener("click", () => {
          let newTheme = body.classList.contains("light-theme")
            ? "dark"
            : "light";
          applyTheme(newTheme);
          localStorage.setItem("theme", newTheme);
        });

        const layoutToggleBtn = document.getElementById("layout-toggle");
        const bookmarksContainer = document.getElementById(
          "bookmarks-container"
        );
        const applyLayout = (layout) => {
          if (layout === "columns") {
            bookmarksContainer.classList.add("layout-columns");
            layoutToggleBtn.innerHTML =
              '<i class="fa-solid fa-grip-lines"></i>';
            layoutToggleBtn.title = "Switch to Row Layout";
          } else {
            bookmarksContainer.classList.remove("layout-columns");
            layoutToggleBtn.innerHTML =
              '<i class="fa-solid fa-table-columns"></i>';
            layoutToggleBtn.title = "Switch to Column Layout";
          }
        };
        const savedLayout = localStorage.getItem("layout") || "rows";
        applyLayout(savedLayout);
        layoutToggleBtn.addEventListener("click", () => {
          let newLayout = bookmarksContainer.classList.contains(
            "layout-columns"
          )
            ? "rows"
            : "columns";
          applyLayout(newLayout);
          localStorage.setItem("layout", newLayout);
        });

        const copyFeedback = document.getElementById("copy-feedback");
        const allCopyButtons = document.querySelectorAll(".copy-btn");
        allCopyButtons.forEach((button) => {
          button.addEventListener("click", (event) => {
            const urlToCopy = event.currentTarget.dataset.url;
            navigator.clipboard.writeText(urlToCopy).then(() => {
              copyFeedback.classList.add("show");
              setTimeout(() => {
                copyFeedback.classList.remove("show");
              }, 2000);
            });
          });
        });

        const allToggleCheckboxes =
          document.querySelectorAll(".section-toggle");
        const allBookmarkSections =
          document.querySelectorAll(".bookmark-section");
        const updateVisibility = () => {
          const checkedSections = new Set();
          allToggleCheckboxes.forEach((checkbox) => {
            if (checkbox.checked) {
              checkedSections.add(checkbox.value);
            }
          });
          allBookmarkSections.forEach((section) => {
            if (checkedSections.has(section.dataset.sectionName)) {
              section.classList.remove("hidden");
            } else {
              section.classList.add("hidden");
            }
          });
        };
        allToggleCheckboxes.forEach((checkbox) => {
          checkbox.addEventListener("change", updateVisibility);
        });
        updateVisibility();
      });
    </script>
  </body>
</html>
